<div class="row mb-2">
  <div class="col">
    <h3>Participants</h3>
  </div>
  <div class="col text-right">
    <button class="btn btn-success btn-labeled" routerLink="/participants/new">
      <span class="btn-label"><i class="bi bi-plus-lg"></i></span>Create Participant
    </button>
  </div>
</div>

<!--filter-->
<div class="filterbox">
  <form>
    <table class="table">
      <tr class="form-row">
		  <div class="form-group col-md-4">
			  <label for="filterParticipantName">Name:</label>
			  <input class="form-control" type="text" id="filterParticipantName" />
		  </div>

		  <div class="form-group col-md-2">
          <label for="filterParticipantId">ID:</label>
          <input class="form-control" type="text" id="filterParticipantId" />
        </div>


        <div class="form-group col-md-2">
          <label for="filterParticipantState">State:</label>
					<select class="form-control" id="filterParticipantState">
						<option value="{{ALL_STR_ID}}">(All)</option>
						<option value="{{item}}" *ngFor="let item of (keywordParticipantState | async)">{{item}}</option>
					</select>
        </div>

		<div class="form-group col-md-2"></div> <!-- spacer-->

		  <div class="form-group col-md-2">
          <label for="filterBtn">&nbsp;</label>
          <button
            type="submit"
            class="form-control btn btn-primary"
            id="filterBtn"
            (click)="search()">
			  Search&nbsp;&nbsp;<i class="bi bi-search"></i>
          </button>
        </div>
      </tr>
    </table>
  </form>
</div>

<!-- Liquidity balance check -->
<section class="d-flex justify-content-end ">
  <button data-toggle="modal" data-target="#liquidityBalanceModel" type="button"
    class="btn btn-primary btn-labeled px-3 py-2 mb-2 mt-6" id="liquidityBalanceModelButton">
    Liquidity Balance Check
  </button>
</section>

<!-- Modal -->
<aside class="modal fade" id="liquidityBalanceModel" tabindex="-1" role="dialog" aria-labelledby="liquidityBalanceModel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header bg-white shadow-sm">
        <h5 class="modal-title font-weight-bolder text-dark" id="liquidityModelTitle">Liquidity Balance Check</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p class="font-weight-normal text-lg ">Please check and adjust funds to ensure balance after settlement.</p>
        <div class="my-3 ">
          <button data-toggle="modal" data-target="#fileUploadModel" class="btn btn-primary mr-3" type="button">Choose
            Local File</button><span>No file chosen</span>
        </div>
        <div class="my-3">
          <button class="btn btn-primary">Validate</button>
        </div>

        <!-- Validate Modal -->
        <section>
          <div class="d-flex align-items-center my-4">
            <i class="bi bi-exclamation-circle text-primary font-weight-bolder p-2"></i>
            <span class="warning-text">
              It appears that the liquidity balance in the system doesn't match the balance in the file you provided. To
              make things right, please make the following fund adjustment request to the checker.
            </span>
          </div>

          <table class="table">
            <thead class="thead-light">
              <tr>
                <th scope="col">Participant Name</th>
                <th scope="col">Activity</th>
                <th scope="col">Amount</th>
                <th scope="col">Currency</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Demo wallet</td>
                <td>Withdraw</td>
                <td>1000</td>
                <td>EUR</td>
              </tr>
            </tbody>
          </table>
        </section>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Request fund adjustment</button>
        <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</aside>

<!--File Upload Modal -->
<aside class="modal fade" id="fileUploadModel" tabindex="-1" role="dialog" aria-labelledby="liquidityBalanceModel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header bg-white shadow-sm">
        <h5 class="modal-title font-weight-bolder text-dark" id="liquidityModelTitle">Upload File</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p class="font-weight-normal text-lg ">Upload settlement finalization report.</p>
        <div class="my-4 border p-4 rounded-lg d-flex flex-column gap-3 justify-content-center align-items-center"
          style="border-style: dashed !important;" (drop)="onFileDropped($event)" (dragover)="onDragOver($event)">
          <div class="circular-progress">
            <i class="bi bi-cloud-arrow-up font-weight-bolder" style="font-size: 4rem;"></i>
          </div>
          <p>Drag & Drop your CSV (or) excel file here</p>
          <p>OR</p>
          <label class="file-uploader rounded-lg bg-primary text-white px-3 py-2" for="fileUpload">Browse files</label>
          <input class="d-none" type="file" id="fileUpload" accept=".xls,.xlsx" (change)="onFileSelected($event)">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Submit</button>
      </div>
    </div>
  </div>
</aside>

<!-- Table -->
<div>
  <table class="table">
    <thead class="thead-light">
      <tr>
        <th scope="col">ID</th>
        <th scope="col">Name</th>
        <th scope="col">State</th>
        <th scope="col"># Accounts</th>
        <th scope="col">Created</th>
        <th scope="col">Last action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of (participants | async)">
        <td>{{ item.id }}</td>
        <td>
          <a routerLink="/participants/{{ item.id }}">{{ item.name }}</a>
        </td>
        <!--      <td>{{item.isActive ? "Active" : "Inactive"}} / {{item.approved ? "Approved" : "Not Approved" }}</td>-->
        <td>{{ item.approved ? "Approved" : "Not Approved" }}</td>
        <td>{{ item.participantAccounts.length }}</td>
        <td class="text-secondary">
          By <span class="text-dark">{{ item.createdBy }}</span> at
          <span class="text-dark">{{ item.createdDate | date : "short" }}</span>
        </td>
        <td class="text-secondary">
          <span class="text-dark">{{ item.changeLog[0].changeType }}</span> at
          <span class="text-dark">{{
            item.changeLog[0].timestamp | date : "short"
          }}</span>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div></div>

<!--pagination
TODO: put in component
-->
<hr>
<nav aria-label="Page navigation"  *ngIf="paginateResult | async; let paginateObj">
	<ul class="pagination justify-content-end">
		<li class="page-item" [ngClass]="{'disabled' : paginateObj.prev == null}">
			<a class="page-link" aria-label="Previous" (click)="search(paginateObj.prev ? paginateObj.prev-1 : 0)">
				<span aria-hidden="true">&laquo;</span>
				<span class="sr-only">Previous</span>
			</a>
		</li>

		<ng-container *ngFor="let item of paginateObj.items">
			<li class="page-item" *ngIf="item != null" [ngClass]="{'active' : item === paginateObj.current}">
				<a class="page-link" (click)="search(item-1)" >{{item}}
					<span class="sr-only" *ngIf="item === paginateObj.current">(current)</span>
				</a>
			</li>
			<li class="page-item disabled" *ngIf="item == null">
				<a class="page-link disabled" *ngIf="!item" >...</a>
			</li>
		</ng-container>

		<li class="page-item"  [ngClass]="{'disabled' : paginateObj.next == null}">
			<a class="page-link" aria-label="Next" (click)="search(paginateObj.next ? paginateObj.next-1 : 0)">
				<span aria-hidden="true">&raquo;</span>
				<span class="sr-only">Next</span>
			</a>
		</li>
	</ul>
</nav>
