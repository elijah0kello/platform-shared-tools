<div class="row">
	<div class="col-md-8 align-self-center">
		<h2>{{(matrix | async)?.settlementModel}}</h2>
	</div>

	<div class="col-md-4 align-self-center">
		<small><strong>ID: </strong> {{(matrix | async)?.id}}
			<a (click)="copyIdToClipboard()"
			   ngbTooltip="Copy ID to clipboard"><i class="bi bi-clipboard-plus"></i></a></small>
	</div>
</div>
<hr>



<div class="row">
	<div class="col-10"> <!-- left col with form -->
		<div class="row">
			<div class="col-4">
				<div class="mb-2">
					<label class="col-form-label text-secondary">State</label>
					<div>{{(matrix | async)?.state}}</div>
				</div>
				</div>
			<div class="col-4">
				<div class="mb-2">
					<label class="col-form-label text-secondary">Settlement Model</label>
					<div>{{(matrix | async)?.settlementModel}}</div>
				</div>
				</div>
			<div class="col-4">
				<div class="mb-2">
					<label class="col-form-label text-secondary">Currency</label>
					<div>{{(matrix | async)?.currencyCode}}</div>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-4">
				<div class="mb-2">
					<label class="col-form-label text-secondary">Start Date</label>
					<div>{{(matrix | async)?.dateFrom | date: 'medium'}}</div>
				</div>
			</div>
			<div class="col-4">
				<div class="mb-2">
					<label class="col-form-label text-secondary">End Date</label>
					<div>{{(matrix | async)?.dateTo | date: 'medium'}}</div>
				</div>
			</div>
			<div class="col-4">
				<div class="mb-2">
					<label class="col-form-label text-secondary">Total Debit Balance</label>
					<div>{{(matrix | async)?.totalDebitBalance}}</div>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-4">
				<div class="mb-2">
					<label class="col-form-label text-secondary">Last Updated</label>
					<div>{{((matrix | async)?.updatedAt) | date: 'medium'}}</div>
				</div>
			</div>

			<div class="col-4">
				<div class="mb-2">
					<label class="col-form-label text-secondary">Total Transfers Count</label>
					<div>{{(matrix | async)?.totalTransferCount}}</div>
				</div>
			</div>

			<div class="col-4">
				<div class="mb-2">
					<label class="col-form-label text-secondary">Total Credit Balance</label>
					<div>{{(matrix | async)?.totalCreditBalance}}</div>
				</div>
			</div>
		</div>



	</div> <!-- left col with form -->

	<div class="col-2"> <!-- right col with action buttons -->
		<button class="btn btn-primary btn-block" *ngIf="(matrix | async)?.state !== 'CLOSED'" (click)="refresh()">Refresh</button>
		<ng-container *ngIf="(matrix | async)?.state === 'IDLE'">
			<button class="btn btn-success btn-block" (click)="recalculate(false)">Recalculate</button>
<!--			<button class="btn btn-success btn-block" (click)="recalculate(true)">Recalculate with new Batches</button>-->
			<button class="btn btn-warning btn-block" (click)="close()">Settle</button>
		</ng-container>

<!--		<ng-container *ngIf="(matrix | async)?.state !== 'IDLE'">
			<button class="btn btn-primary btn-block" [disabled]="editing || (matrix | async)?.isActive"
					(click)="approve()" [hidden]="(matrix | async)?.type ==='HUB'">Approve
			</button>
		</ng-container>-->

	</div> <!-- right col with action buttons -->
</div>

<ul ngbNav #nav="ngbNav" class="mt-4 nav-tabs" (navChange)="tabChange($event)">


	<li ngbNavItem="batches" > <!-- batches -->
		<a ngbNavLink>Batches</a>
		<ng-template ngbNavContent>
			<h4 class="mt-3">Baches included in this matrix</h4>
			<table class="table table-hover mt-3">
				<thead class="thead-light">
				<tr>
					<th scope="col">Batch ID</th>
					<th scope="col">Name</th>
					<th scope="col">Debit Balance</th>
					<th scope="col">Credit Balance</th>
					<th scope="col">Transfer Count</th>
					<th scope="col">Accounts</th>
					<th scope="col">Closed?</th>

				</tr>
				</thead>
				<tbody>
				<ng-container *ngIf="(matrix | async)?.batches?.length==0">
					<tr class="" >
						<td colspan="6">No batches found, please try again with different criteria</td>
					</tr>
				</ng-container>
				<tr *ngFor="let item of (matrix | async)?.batches">
					<td><a routerLink="/settlements/batches/{{item.id}}">{{item.id}}</a></td>
					<td>{{item.name}}</td>
					<td>{{item.batchDebitBalance}}</td>
					<td>{{item.batchCreditBalance}}</td>
					<td>{{item.batchTransferCount}}</td>
					<td>{{item.batchAccounts?.length}}</td>
					<td>{{item.isClosed}}</td>
				</tr>
				</tbody>
			</table>
		</ng-template>
	</li> <!-- Batches -->

	<li ngbNavItem="perParticipantTotals" > <!-- per participant totals -->
		<a ngbNavLink>Participants</a>
		<ng-template ngbNavContent>
			<h4 class="mt-3">Per participant totals</h4>
			<table class="table table-hover mt-3">
				<thead class="thead-light">
				<tr>
					<th scope="col">Participant Id</th>
					<th scope="col">Credit Balance</th>
					<th scope="col">Debit Balance</th>
				</tr>
				</thead>
				<tbody>
				<tr *ngFor="let item of (matrix | async)?.participantBalances">
					<td><a routerLink="/participants/{{item.participantId}}">{{item.participantId}}</a></td>
					<td>{{item.creditBalance}}</td>
					<td>{{item.debitBalance}}</td>
				</tr>
				</tbody>
			</table>
		</ng-template>
	</li> <!-- Per participant totals -->

	<li ngbNavItem="transfers" > <!-- transfers -->
		<a ngbNavLink>Transfers</a>
		<ng-template ngbNavContent>
			<h4 class="mt-3">Transfers</h4>
			<table class="table table-hover mt-3">
				<thead class="thead-light">
				<tr>
					<th scope="col">Transfer Id</th>
					<th scope="col">Payer Id</th>
					<th scope="col">Payee Id</th>
					<th scope="col">Amount</th>
					<th scope="col">Timestamp</th>
					<th scope="col">Batch Id</th>
				</tr>
				</thead>
				<tbody>
				<tr *ngFor="let item of (transfers | async)">
					<td><a routerLink="/transfers/{{item.transferId}}">{{item.transferId}}</a></td>
					<td><a routerLink="/participants/{{item.payerFspId}}">{{item.payerFspId}}</a></td>
					<td><a routerLink="/participants/{{item.payeeFspId}}">{{item.payeeFspId}}</a></td>
					<td>{{item.amount}} ({{item.currencyCode}})</td>
					<td>{{item.transferTimestamp | date:'medium'}}</td>
					<td>{{item.batchId}}</td>
				</tr>
				</tbody>
			</table>
		</ng-template>
	</li> <!-- Per participant totals -->
</ul>


<div class="mt-6" [ngbNavOutlet]="nav"></div>

<!--<pre>{{matrix | async | json}}</pre>-->
